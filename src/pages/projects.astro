---
import Layout from "../layouts/Layout.astro";
import { Image } from "astro:assets";
import { Github, Globe } from "@lucide/astro";
import { meta, projects } from "../consts.ts";
---

<Layout title={meta.projects.title} description={meta.projects.description}>
  <h2>
    <span class="fancy-highlight">Mis Proyectos</span>
  </h2>

  <section class="mt-6 flex flex-col gap-10">
    {
      projects.map((proj) => (
        <div class="flex flex-col gap-4">
          <div class="flex gap-4 items-start">
            <div class="w-1/6 flex items-center">
              <Image
                src={proj.logoImage}
                alt={`${proj.title} logo`}
                class="w-20 h-20 object-contain"
              />
            </div>

            <div class="flex-1">
              <h3 class="text-xl font-semibold">{proj.title}</h3>

              <div class="mt-1 flex flex-wrap gap-1">
                {proj.techs?.map((tech) => (
                  <span class="primary-badge">{tech}</span>
                ))}
              </div>

              <p class="text-base-content/80 mt-2">{proj.description}</p>

              <div class="mt-3 flex gap-2">
                <a
                  href={proj.sourceHref}
                  target="_blank"
                  class={`btn btn-soft flex-1 ${
                    !proj.sourceHref ? "btn-disabled" : ""
                  }`}
                >
                  <Github /> Source
                </a>
                <a
                  href={proj.liveHref}
                  target="_blank"
                  class={`btn btn-soft btn-accent flex-1 ${
                    !proj.liveHref ? "btn-disabled" : ""
                  }`}
                >
                  <Globe /> Live
                </a>
              </div>
            </div>
          </div>

          {/* ✅ CARRUSEL FUNCIONAL */}
          {proj.images && proj.images.length > 0 && (
            <div
              class="relative w-full max-w-md mx-auto overflow-hidden rounded-xl shadow-lg mt-4"
              data-carousel={proj.title.replace(/\s+/g, "")}
            >
              <div class="flex transition-transform duration-500 ease-in-out">
                {proj.images.map((img, index) => (
                  <Image
                    src={img}
                    alt={`${proj.title} ${index + 1}`}
                    class="w-full h-64 sm:h-72 md:h-80 object-cover flex-shrink-0"
                    loading="lazy"
                  />
                ))}
              </div>

              <button
                class="absolute left-3 top-1/2 transform -translate-y-1/2 btn btn-circle"
                data-prev
              >
                ❮
              </button>
              <button
                class="absolute right-3 top-1/2 transform -translate-y-1/2 btn btn-circle"
                data-next
              >
                ❯
              </button>
            </div>
          )}
        </div>
      ))
    }
  </section>

  <!-- ✅ Script de carrusel con cliente habilitado -->
  <script is:client>
    const carousels = document.querySelectorAll("[data-carousel]");
    carousels.forEach((carousel) => {
      const track = carousel.querySelector(".flex");
      const slides = carousel.querySelectorAll("img");
      const nextBtn = carousel.querySelector("[data-next]");
      const prevBtn = carousel.querySelector("[data-prev]");
      let index = 0;

      function update() {
        track.style.transform = `translateX(-${index * 100}%)`;
      }

      nextBtn.addEventListener("click", () => {
        index = (index + 1) % slides.length;
        update();
      });

      prevBtn.addEventListener("click", () => {
        index = (index - 1 + slides.length) % slides.length;
        update();
      });
    });
  </script>
</Layout>
